set(destdir "$ENV{DESTDIR}")
if(destdir STREQUAL "")
  set(destdir "")
endif()

if(destdir STREQUAL "")
  find_program(systemctl_exe systemctl)
  if(systemctl_exe)
    execute_process(COMMAND "${systemctl_exe}" stop "remountd.socket" "remountd.service"
      RESULT_VARIABLE ignored)
    execute_process(COMMAND "${systemctl_exe}" disable "remountd.socket"
      RESULT_VARIABLE ignored)
  endif()
endif()

file(REMOVE
  "${destdir}@REMOUNTD_SYSTEMD_UNITDIR@/remountd.service"
  "${destdir}@REMOUNTD_SYSTEMD_UNITDIR@/remountd.socket"
  "${destdir}@REMOUNTD_RUNDIR@/remountd.sock"
  "${destdir}@REMOUNTD_SBINDIR@/remountd"
  "${destdir}@REMOUNTD_BINDIR@/remountctl")

set(run_dir "${destdir}@REMOUNTD_RUNDIR@")
if(IS_DIRECTORY "${run_dir}")
  file(GLOB remaining "${run_dir}/*")
  if(NOT remaining)
    file(REMOVE_RECURSE "${run_dir}")
  endif()
endif()
