[ -n "$CODEX_WORKSPACE" ] || export CODEX_WORKSPACE="$TOPPROJECT"
export CODEX_REPOBASE="remountd.git"
# The (fixed) cwd that codex works in (relative to $CODEX_REPOBASE).
export CODEX_DIRECTORY=

# To satisfy the sanity check at the top of `codex.run`.
export REPOBASE="$CODEX_WORKSPACE/$CODEX_REPOBASE"

export LIBCWD_RCFILE_OVERRIDE_NAME="$CODEX_WORKSPACE/libcwdrc_remountd"
export BUILDDIR=$TOPPROJECT/remountd-build

#CMAKE_CONFIG=RelWithDebInfo
#CMAKE_CONFIG=RelWithDebug
CMAKE_CONFIG=Debug
#CMAKE_CONFIG=BetaTest
#CMAKE_CONFIG=Release
#CMAKE_CONFIG=Perf
#  "-GNinja"
CMAKE_CONFIGURE_OPTIONS=(
  "-DCMAKE_VERBOSE_MAKEFILE=OFF"
  "-DCMAKE_MESSAGE_LOG_LEVEL=DEBUG"
  "-DEnableDebug=ON"
)

if [ -n "$CODEX_INSIDE_ENVIRONMENT" ]; then
  # Give codex its own build directory.
  BUILDDIR="$CODEX_WORKSPACE/codex-build"
  if [[ $CODEX_SHELL = "no" ]]; then
    # Only use a different committer name if it is really Codex that does the commit.
    export GIT_COMMITTER_NAME='Daniel Codex'
  fi

  # Make compilation less verbose.
  change_config "-DCMAKE_VERBOSE_MAKEFILE=OFF"
  change_config "-DCMAKE_MESSAGE_LOG_LEVEL=DEBUG"
fi

# For the sake of printing instructions.
export CMAKE_CONFIGURE_OPTIONS_STR=$(printf "%s|" "${CMAKE_CONFIGURE_OPTIONS[@]}")

export CMAKE_CONFIG

# Print relevant source files of the project.
function prs() {
  /bin/ls $REPOBASE/{src,cwds}/*.{h,cxx}
}

# Print relevant source files of the project.
function s() {
  prs
}

alias remountd="$BUILDDIR/src/remountd"
alias remountctl="$BUILDDIR/src/remountctl"
